#!/bin/bash
set -euo pipefail

echo "PUBLIC FOLDER"
ls -R -lha ./backend/public

ENVIRONMENT_NAME="production"

echo "============================================================="
echo "     CREANDO IMAGEN DOCKER                                   "
echo "============================================================="
IMAGE_NAME="registry.heroku.com/${HEROKU_APP_NAME}/web"

cd backend

echo "${HEROKU_OWNER_EMAIL}    ----  ${HEROKU_KEY}    ----- ${HEROKU_APP_NAME}"

echo "$HEROKU_KEY" | docker login --username ${HEROKU_OWNER_EMAIL} --password-stdin registry.heroku.com
docker build -t $IMAGE_NAME \
    --build-arg environment_name=${ENVIRONMENT_NAME} .

echo "============================================================="
echo "     PUBLICANDO VERSION ${PACKAGE_VERSION}...                                          "
echo "============================================================="
docker push $IMAGE_NAME
